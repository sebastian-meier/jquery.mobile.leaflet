/*!
 * jQuery Mobile Widget v1.0
 * https://github.com/sebastian-meier/jquery.mobile.leaflet
 *
 * Copyright 2013, Sebastian Meier
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * This plugin requires the jQuery-, jQuery-Mobile & the Leaflet-Library
 *
 */(function($){$.widget("mobile.leaflet",$.mobile.widget,{options:{leafletAttribution:!0,config:{zoomControl:!1,zoom:11,attributionControl:!0,center:[52.52,13.41]},tileLayer:{url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",config:{layers:"",format:"image/png",transparent:!0,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'},wms:!1},marker:{},initSelector:".map"},_create:function(){var self=this,options=$.extend(this.options,this.element.jqmData("options")),map={element:this.element,id:this.element.attr("id"),map:undefined,marker:[],layer:[],lines:[]};self.map=map;typeof self.map.element.attr("data-zoom")!="undefined"&&(self.options.config.zoom=$(this).attr("data-zoom"));typeof self.map.element.attr("data-lat")!="undefined"&&typeof self.map.element.attr("data-lng")!="undefined"&&(self.options.config.center=[self.map.element.attr("data-lat"),self.map.element.attr("data-lng")]);self.map.map=new L.map(self.map.id,self.options.config);options.config.leafletAttribution||self.map.map.attributionControl.setPrefix("");options.tileLayer.wms?self.map.layer.push(L.tileLayer.wms(options.tileLayer.url,options.tileLayer.config).addTo(self.map.map)):self.map.layer.push(L.tileLayer(options.tileLayer.url,options.tileLayer.config).addTo(self.map.map));typeof self.map.element.attr("data-marker-lat")!="undefined"&&typeof self.map.element.attr("data-marker-lng")!="undefined"&&self.createMarker([self.map.element.attr("data-marker-lat"),self.map.element.attr("data-marker-lng")]);eval("typeof "+self.map.id+"_marker")!=="undefined"&&$.each(eval(self.map.id+"_marker"),function(e,t){self.createMarker(t)})},createMarker:function(e){var t,n,r=this;if(e instanceof Array){t=e[0];n=e[1]}else{if(!(e instanceof Object))return undefined;t=e.lat;n=e.lng;var i=$.extend(this.options.marker,e)}var s=L.marker(new L.LatLng(r.cleanCoordinate(t),r.cleanCoordinate(n)),i);s.addTo(r.map.map);r.map.marker.push(s);return s},cleanCoordinate:function(e){switch(typeof e){case"String":return parseFloat(e.replace(",","."));case"number":return parseFloat(e);default:return e}},clearMarker:function(){var e=this;$.each(e.map.marker,function(t,n){e.map.map.removeLayer(n)});e.map.marker=[]},clearLines:function(){var e=this;$.each(e.map.lines,function(t,n){e.map.map.removeLayer(n)});e.map.lines=[]},clearLayer:function(){var e=this;$.each(e.map.layer,function(t,n){e.map.map.removeLayer(n)});e.map.layer=[]},getMap:function(){return this.map.map},getData:function(){return this.map}})})(jQuery);